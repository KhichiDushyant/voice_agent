{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carematix Healthcare Platform - Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        {% csrf_token %}
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-heart-pulse"></i>
                    <span>Carematix</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-view="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#patients" class="nav-item" data-view="patients">
                    <i class="fas fa-users"></i>
                    <span>Patients</span>
                </a>
                <a href="#nurses" class="nav-item" data-view="nurses">
                    <i class="fas fa-user-nurse"></i>
                    <span>Nurses</span>
                </a>
                <a href="#nurse-schedule" class="nav-item" data-view="nurse-schedule">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Nurse Schedule</span>
                </a>
                <a href="#appointments" class="nav-item" data-view="appointments">
                    <i class="fas fa-calendar-check"></i>
                    <span>Appointments</span>
                </a>
                <a href="#calls" class="nav-item" data-view="calls">
                    <i class="fas fa-phone"></i>
                    <span>Call History</span>
                </a>
                <a href="#analytics" class="nav-item" data-view="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                </a>
                <a href="/admin/" class="nav-item" target="_blank">
                    <i class="fas fa-cog"></i>
                    <span>Admin</span>
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <div class="top-bar-left">
                    <h1 id="page-title">Dashboard</h1>
                    <div class="status-badge">
                        <span class="status-indicator status-online"></span>
                        <span>System Online</span>
                    </div>
                </div>
                <div class="top-bar-right">
                    <div class="notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count" id="notification-count">0</span>
                    </div>
                    <div class="user-menu">
                        <i class="fas fa-user-circle"></i>
                        <span>Healthcare Admin</span>
                    </div>
                </div>
            </header>
            
            <!-- Dashboard View -->
            <div class="view" id="dashboard-view">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon patients">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="patient-count">-</h3>
                            <p>Total Patients</p>
                            <span class="stat-change positive">+5% this month</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon nurses">
                            <i class="fas fa-user-nurse"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="nurse-count">-</h3>
                            <p>Active Nurses</p>
                            <span class="stat-change neutral">No change</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon appointments">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="appointment-count">-</h3>
                            <p>Today's Appointments</p>
                            <span class="stat-change positive">+2 vs yesterday</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon calls">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="call-count">-</h3>
                            <p>Total Calls</p>
                            <span class="stat-change positive">95% success rate</span>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="dashboard-card recent-appointments">
                        <div class="card-header">
                            <h3><i class="fas fa-calendar-check"></i> Today's Appointments</h3>
                            <button class="btn btn-sm" onclick="showView('appointments')">View All</button>
                        </div>
                        <div class="card-content" id="recent-appointments">
                            <div class="loading">Loading appointments...</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card recent-calls">
                        <div class="card-header">
                            <h3><i class="fas fa-phone"></i> Recent Calls</h3>
                            <button class="btn btn-sm" onclick="showView('calls')">View All</button>
                        </div>
                        <div class="card-content" id="recent-calls">
                            <div class="loading">Loading calls...</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card quick-actions">
                        <div class="card-header">
                            <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                        </div>
                        <div class="card-content">
                            <button class="action-btn" onclick="quickScheduleAppointment()">
                                <i class="fas fa-plus-circle"></i>
                                Schedule Appointment
                            </button>
                            <button class="action-btn" onclick="makeTestCall()">
                                <i class="fas fa-phone-alt"></i>
                                Make Test Call
                            </button>
                            <button class="action-btn" onclick="quickAddPatient()">
                                <i class="fas fa-user-plus"></i>
                                Add Patient
                            </button>
                            <button class="action-btn" onclick="viewAnalytics()">
                                <i class="fas fa-chart-bar"></i>
                                View Analytics
                            </button>
                        </div>
                    </div>
                    
                    <div class="dashboard-card nurse-availability">
                        <div class="card-header">
                            <h3><i class="fas fa-user-nurse"></i> Nurse Availability</h3>
                        </div>
                        <div class="card-content" id="nurse-availability">
                            <div class="loading">Loading availability...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Patients View -->
            <div class="view" id="patients-view" style="display: none;">
                <div class="page-header">
                    <h2>Patient Management</h2>
                    <button class="btn btn-primary" onclick="showAddPatientModal()"><i class="fas fa-plus"></i> Add Patient</button>
                </div>
                <div class="data-table-container">
                    <div class="table-filters">
                        <input type="text" id="patient-search" placeholder="Search patients..." class="search-input">
                        <select id="patient-filter" class="filter-select">
                            <option value="">All Patients</option>
                            <option value="assigned">Assigned to Nurse</option>
                            <option value="unassigned">Unassigned</option>
                        </select>
                    </div>
                    <div id="patients-table" class="data-table"></div>
                </div>
            </div>
            
            <!-- Nurses View -->
            <div class="view" id="nurses-view" style="display: none;">
                <div class="page-header">
                    <h2>Nurse Management</h2>
                    <button class="btn btn-primary" onclick="showAddNurseModal()"><i class="fas fa-plus"></i> Add Nurse</button>
                </div>
                <div class="data-table-container">
                    <div class="table-filters">
                        <input type="text" id="nurse-search" placeholder="Search nurses..." class="search-input">
                        <select id="nurse-filter" class="filter-select">
                            <option value="">All Nurses</option>
                            <option value="available">Available Today</option>
                            <option value="busy">Busy Today</option>
                        </select>
                    </div>
                    <div id="nurses-table" class="data-table"></div>
                </div>
            </div>
            
            <!-- Nurse Schedule View -->
            <div class="view" id="nurse-schedule-view" style="display: none;">
                <div class="page-header">
                    <h2>Nurse Schedule & Availability</h2>
                    <div class="schedule-controls">
                        <button class="btn btn-outline" onclick="previousWeek()">
                            <i class="fas fa-chevron-left"></i> Previous Week
                        </button>
                        <span class="current-week" id="current-week">Week of Dec 18, 2023</span>
                        <button class="btn btn-outline" onclick="nextWeek()">
                            Next Week <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="btn btn-primary" onclick="showAddAvailabilityModal()">
                            <i class="fas fa-plus"></i> Add Availability
                        </button>
                    </div>
                </div>
                
                <div class="schedule-container">
                    <div class="nurse-selector">
                        <label for="nurse-filter-select">Filter by Nurse:</label>
                        <select id="nurse-filter-select" class="form-select" onchange="filterNurseSchedule()">
                            <option value="">All Nurses</option>
                        </select>
                    </div>
                    
                    <div class="schedule-grid">
                        <div class="schedule-header">
                            <div class="time-column">Time</div>
                            <div class="day-column">Monday</div>
                            <div class="day-column">Tuesday</div>
                            <div class="day-column">Wednesday</div>
                            <div class="day-column">Thursday</div>
                            <div class="day-column">Friday</div>
                            <div class="day-column">Saturday</div>
                            <div class="day-column">Sunday</div>
                        </div>
                        <div class="schedule-body" id="schedule-body">
                            <!-- Schedule content will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="availability-summary">
                    <div class="summary-card">
                        <h3><i class="fas fa-chart-pie"></i> Availability Summary</h3>
                        <div class="summary-stats" id="availability-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="total-nurses">-</span>
                                <span class="stat-label">Total Nurses</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="available-today">-</span>
                                <span class="stat-label">Available Slots</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="busy-today">-</span>
                                <span class="stat-label">Busy Slots</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="coverage-percentage">-</span>
                                <span class="stat-label">Coverage %</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Appointments View -->
            <div class="view" id="appointments-view" style="display: none;">
                <div class="page-header">
                    <h2>Appointment Management</h2>
                    <button class="btn btn-primary" onclick="showScheduleModal()"><i class="fas fa-plus"></i> Schedule Appointment</button>
                </div>
                <div class="appointments-container">
                    <div class="calendar-view" id="appointments-calendar"></div>
                    <div class="appointments-list" id="appointments-list"></div>
                </div>
            </div>
            
            <!-- Calls View -->
            <div class="view" id="calls-view" style="display: none;">
                <div class="page-header">
                    <h2><i class="fas fa-headset"></i> Live Call Center</h2>
                    <div class="call-controls">
                        <button class="btn btn-success" onclick="makeTestCall()">
                            <i class="fas fa-phone"></i> Make Call
                        </button>
                        <button class="btn btn-warning" onclick="toggleAutoRefresh()">
                            <i class="fas fa-sync-alt"></i> <span id="auto-refresh-text">Auto Refresh</span>
                        </button>
                    </div>
                </div>
                
                <!-- Call Stats Dashboard -->
                <div class="call-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-phone-volume"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-calls">-</div>
                            <div class="stat-label">Total Calls</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="completed-calls">-</div>
                            <div class="stat-label">Completed</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="failed-calls">-</div>
                            <div class="stat-label">Failed</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="avg-duration">-</div>
                            <div class="stat-label">Avg Duration</div>
                        </div>
                    </div>
                </div>

                <!-- Live Call Feed -->
                <div class="live-call-feed">
                    <div class="feed-header">
                        <h3><i class="fas fa-broadcast-tower"></i> Live Call Activity</h3>
                        <div class="live-indicator">
                            <span class="pulse-dot"></span>
                            <span>LIVE</span>
                        </div>
                    </div>
                    <div id="live-calls-container" class="live-calls-list">
                        <!-- Live calls will be populated here -->
                    </div>
                </div>

                <!-- Call History Table -->
                <div class="call-history-section">
                    <div class="section-header">
                        <h3><i class="fas fa-history"></i> Call History</h3>
                        <div class="table-filters">
                            <input type="text" id="calls-search" placeholder="Search calls..." class="search-input">
                            <input type="date" id="calls-date-filter" class="filter-select">
                            <select id="calls-status-filter" class="filter-select">
                                <option value="">All Status</option>
                                <option value="completed">Completed</option>
                                <option value="failed">Failed</option>
                                <option value="in_progress">In Progress</option>
                            </select>
                        </div>
                    </div>
                    <div id="calls-table" class="modern-calls-table"></div>
                </div>
            </div>
            
            <!-- Analytics View -->
            <div class="view" id="analytics-view" style="display: none;">
                <div class="page-header">
                    <h2>Analytics & Reports</h2>
                </div>
                <div class="analytics-grid">
                    <div class="chart-card">
                        <h3>Appointments by Day</h3>
                        <canvas id="appointments-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Call Success Rate</h3>
                        <canvas id="calls-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Patient Distribution</h3>
                        <canvas id="patients-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Nurse Workload</h3>
                        <canvas id="nurses-chart"></canvas>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Modals -->
        <div id="modal-overlay" class="modal-overlay">
            <div id="modal" class="modal">
                <div class="modal-header">
                    <h3 id="modal-title">Modal Title</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- Modal content will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading...</p>
            </div>
        </div>
        
        <!-- Toast Notifications -->
        <div id="toast-container" class="toast-container"></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>
